{% extends "layouts/main.html" %}

{% set pageName="Request support" %}

{% block beforeContent %}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "Home",
        href: "/"
      },
      {
        text: "Request support"
      }
    ]
  }) }}
  <a class="govuk-back-link" href="javascript:history.back()">Back</a>
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <main id="main-content" role="main">

    <h1 class="govuk-heading-xl">Request support</h1>
    
    <p class="govuk-body-l">Get help with AI tools, licensing, or technical issues.</p>

    {{ govukInsetText({
      text: "For quick questions or to connect with the community, you can also ask in the #ask-ace Slack channel."
    }) }}

    {% if data['errors'] %}
      {{ govukErrorSummary({
        titleText: "There is a problem",
        errorList: [
          {
            text: data['errors']['name'],
            href: "#name"
          } if data['errors']['name'],
          {
            text: data['errors']['email'],
            href: "#email"
          } if data['errors']['email'],
          {
            text: data['errors']['request-type'],
            href: "#request-type"
          } if data['errors']['request-type'],
          {
            text: data['errors']['details'],
            href: "#details"
          } if data['errors']['details'],
          {
            text: data['errors']['urgency'],
            href: "#urgency"
          } if data['errors']['urgency']
        ] | selectattr("text")
      }) }}
    {% endif %}

    <form class="form" action="/request-form" method="post">

      <h2 class="govuk-heading-l">Your details</h2>

      {{ govukInput({
        label: {
          text: "Your name"
        },
        id: "name",
        name: "name",
        value: data['name'],
        errorMessage: {
          text: data['errors']['name']
        } if data['errors']['name']
      }) }}

      {{ govukInput({
        label: {
          text: "Your email address"
        },
        id: "email",
        name: "email",
        type: "email",
        value: data['email'],
        errorMessage: {
          text: data['errors']['email']
        } if data['errors']['email']
      }) }}

      {{ govukInput({
        label: {
          text: "Your department or team"
        },
        id: "department",
        name: "department",
        value: data['department']
      }) }}

      <h2 class="govuk-heading-l">Your request</h2>

      {{ govukRadios({
        name: "request-type",
        fieldset: {
          legend: {
            text: "What do you need help with?",
            classes: "govuk-fieldset__legend--m"
          }
        },
        items: [
          {
            value: "licence",
            text: "Licence acquisition for approved AI tools",
            checked: true if data['request-type'] == 'licence'
          },
          {
            value: "training",
            text: "Training on using AI effectively",
            checked: true if data['request-type'] == 'training'
          },
          {
            value: "technical",
            text: "Technical issues with AI tools",
            checked: true if data['request-type'] == 'technical'
          },
          {
            value: "guidance",
            text: "General AI guidance question",
            checked: true if data['request-type'] == 'guidance'
          },
          {
            value: "other",
            text: "Other",
            checked: true if data['request-type'] == 'other'
          }
        ],
        errorMessage: {
          text: data['errors']['request-type']
        } if data['errors']['request-type']
      }) }}

      {{ govukTextarea({
        name: "details",
        id: "details",
        label: {
          text: "Tell us more about your request"
        },
        hint: {
          text: "Include as much detail as possible to help us respond quickly."
        },
        rows: 8,
        value: data['details'],
        errorMessage: {
          text: data['errors']['details']
        } if data['errors']['details']
      }) }}

      {{ govukRadios({
        name: "urgency",
        fieldset: {
          legend: {
            text: "How urgent is this request?",
            classes: "govuk-fieldset__legend--m"
          }
        },
        items: [
          {
            value: "low",
            text: "Low - respond within 5 working days",
            checked: true if data['urgency'] == 'low'
          },
          {
            value: "medium",
            text: "Medium - respond within 2 working days",
            checked: true if data['urgency'] == 'medium'
          },
          {
            value: "high",
            text: "High - respond within 1 working day",
            checked: true if data['urgency'] == 'high'
          }
        ],
        errorMessage: {
          text: data['errors']['urgency']
        } if data['errors']['urgency']
      }) }}

      {{ govukButton({
        text: "Submit request"
      }) }}

    </form>

    </main>
  </div>
</div>

{% endblock %}